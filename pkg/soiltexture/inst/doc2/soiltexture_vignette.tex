% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Document header                                             |
% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+

\documentclass[a4paper]{article}

\title{The soil texture wizard:\\R functions for plotting, 
    classifying, transforming and exploring soil texture data} 

\author{Julien Moeys}
% In case of changes, also change the 'PDF setup' and 
% 'cited as follow'



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Nodifications of the Sweave style                           |
% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+

% Load Sweave and color, in order to modify 
% sweave's environments:

\RequirePackage{Sweave,color,placeins,rotating,subfig} % ,sweave
%\usepackage{underscore}
 
% Also modified in the document

% Define new colors used in the document:
\definecolor{BrickRed}{rgb}{0.502,0.000,0.000}
\definecolor{MidnightBlue}{rgb}{0.000,0.000,0.502} 
% NB: no space after the colors

% Modify the definition of the 'Sinput' environment:
\RecustomVerbatimEnvironment{Sinput}{Verbatim}{%
    formatcom   = \color{BrickRed}, % new text color
    frame       = leftline,         % vert line on the left
    framerule   = 0.50mm            % width of the vert line
}   %

% Modify the definition of the 'Scode' environment:
\RecustomVerbatimEnvironment{Scode}{Verbatim}{%
    formatcom   = \color{BrickRed}, % new text color
    frame       = leftline,         % vert line on the left
    framerule   = 0.50mm            % width of the vert line
}   %

% Modify the definition of the 'Soutput' environment:
\RecustomVerbatimEnvironment{Soutput}{Verbatim}{%
    formatcom = \color{MidnightBlue}% new text color
}   %

% Modify the spacing between R code and R outputs:
\fvset{listparameters={\setlength{\topsep}{0pt}}} 
\renewenvironment{Schunk}{\vspace{\topsep}}{\vspace{\topsep}} 

\renewcommand\floatpagefraction{1.0}
\renewcommand\topfraction{1.0}
\renewcommand\bottomfraction{1.0}
\renewcommand\textfraction{0.0}   
\setcounter{topnumber}{4}
\setcounter{bottomnumber}{4}
\setcounter{totalnumber}{12}



%%% PDF setup -- fill in the title
\usepackage[dvipdfm, bookmarks, colorlinks, breaklinks, %
    pdftitle={The soil texture wizard:R functions for plotting, classifying, transforming and exploring soil texture data},%
    pdfauthor={Julien MOEYS}]{hyperref}  
\hypersetup{linkcolor=MidnightBlue, citecolor=MidnightBlue, 
    filecolor=MidnightBlue,urlcolor=MidnightBlue} 
% From: http://malecki.wustl.edu/sweaveTemplate.Rnw

% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Beginning of the real document                              |
% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+

% Don't forget to add this to path:
% C:\Program Files\_SCIENCE\R_PROJECT\share\texmf

\usepackage{Sweave}
\begin{document}
\bibliographystyle{plain}


% \graphicspath{{INOUT/}} 


%INVISIBLY sets a few options for Sweave :: KEEP THIS

% \SweaveOpts{width=14,height=14,keep.source=TRUE}



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Front page TITLE 
\maketitle



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Front page build number 


\begin{center}\textit{build number 49.}\end{center}





% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Edit here                  |
% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Front page image:


\begin{figure}[b]
\centering
\includegraphics{soiltexture_vignette-COVERFIG}
\end{figure}

\clearpage 

% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% | Table of Content:
\tableofcontents 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{About this document} 



\subsection{Why creating 'The soil texture wizard'?} 

\textbf{Officially}: \textit{The Soil Texture Wizard} R functions 
are an attempt to provide a generic toolbox for soil texture data 
in R. These functions can (1) plot soil texture data (2) classify 
soil texture data, (3) transform soil texture data from and to 
different systems of particle size classes, and (4) provide some 
tools to 'explore' soil texture data (in the sense of a 
statistical visual analysis). All there tools are designed to be 
inherently multi-triangles, multi-geometry and multi-particle 
sizes classification\\

\textbf{Officiously}: What was initially a slight reshape of R 
PLOTRIX package (by J. Lemon and B. Bolker), for my personal use%
\footnote{It was also an excellent way to learn R.}, 
to add the French 'Aisne' soil texture triangle, gradually 
skidded and ended up in a totally reshaped and extended code 
(over a 3 year period). There is unfortunately no compatibility 
at all between the two codes.\\



\subsection{About R} 


This document is about functions (and package project) written in 
\href{http://www.R-project.org}{R "language and environment for statistical computing"} 
(\cite{RDCT2009}), and has been generated with 
R version 2.11.0 (2010-04-22).\\

R website: <\url{http://www.R-project.org}>\\

If you don't know about R, it is never too later to start...\\



\subsection{About the author} 

I am an agriculture engineer, soil scientist and R programmer. 
See my website for more details (\url{http://julienmoeys.free.fr/}).\\

The R functions presented in this document may not always conform 
to the 'best R programming practices', they are nevertheless 
programmed carefully, well checked, and should work efficiently 
for most uses.\\

At this stage of development, some bugs should still be expected. 
The code has been written in 3 years, and tested quite extensively 
since then, but it has never been used by other people. If you 
find some bugs, please contact me at:


\begin{figure}[h] 
\centering 
\includegraphics[width=108px,viewport=0 0 382 25]{% 
    julienmoeysmailaddress-382-25.png} 
\end{figure} 



\subsection{Credits and License} 

This document, as well as this \textbf{document} source code 
(written in \href{http://en.wikipedia.org/wiki/Sweave}{Sweave}, 
\href{http://www.r-project.org}{R} and 
\href{http://en.wikipedia.org/wiki/LaTeX}{\LaTeX}) are 
licensed under a \textbf{\href{% 
http://creativecommons.org/licenses/by-sa/3.0/}{Creative 
Commons By-SA 3.0 (unported)}}.


\begin{figure}[h] 
\centering 
\includegraphics[width=88px,viewport=0 0 88 31]{% 
    CC-By-SA-nonported-88x31.PNG} 
\end{figure} 


In short, this means (\textit{extract from the abovementioned url at 
creativecommons.org}):

\begin{itemize} 
    \item You are free to:
    \begin{itemize} 
        \item \textbf{to Share} - to copy, distribute and 
        transmit the work;
        \item \textbf{to Remix} - to adapt the work.
    \end{itemize} 
    \item Under the following conditions:
    \begin{itemize} 
        \item \textbf{Attribution} - You must attribute the work 
        in the manner specified by the author or licensor (but 
        not in any way that suggests that they endorse you or 
        your use of the work);
        \item \textbf{Share Alike} - If you alter, transform, or 
        build upon this work, you may distribute the resulting 
        work only under the same, similar or a compatible 
        license.
    \end{itemize} 
\end{itemize} 

'The soil texture wizard' R \textbf{functions} are licensed under 
a \href{http://www.gnu.org/licenses/gpl-3.0.html}{GNU General 
Public License Version 3}.\\

Given the fact that a lot of the work presented here has been done 
on my free time, and given its highly permissive license, \textbf{% 
this document is provided with NO responsibilities, guarantees or 
supports from the author or his employer} (Swedish University of 
Agricultural Sciences).\\

Please notice that the R software itself is licensed under a GNU 
General Public License Version 2, June 1991.\\

This tutorial has been created with the (great) \textbf{Sweave} 
tool, from Friedrich Leisch (\cite{SWEAVE2002}). Sweave allows the 
smooth integration of R code and R output (including figures) in 
a \LaTeX document.



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{Introduction: About soil texture, texture triangles 
    and texture classifications} 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{What are soil granulometry and soil texture(s)?} 

\textbf{Soil granulometry} is the repartition of soil solid 
particles between (a range of) particle sizes. As the range of 
particle sizes is in fact continuous, they have been subdivided 
into different \textbf{particle size classes}.\\

The most common subdivision of soil granulometry into classes is 
the \textbf{fine earth}, for particles ranging from \textbf{0 to 
2mm (2000$\mu$m)}, and \textbf{coarse particles}, for 
particles bigger than \textbf{2mm}. Only the fine earth interests 
us in this document, although the study of soil granulometry can 
be extended to the coarse fraction (for stony soils).\\

\textbf{Fine earth} is generally (but not always; see below) divided 
into \textbf{3 particle size classes: clay (fine particles), silt 
(medium size particles) and sand (coarser particles in the fine 
earth)}. All soil scientists use the range \textbf{0-2$\mu$m} for 
\textbf{clay}. So silt lower limit is also always 
\textbf{2$\mu$m}. But the convention for \textbf{silt / sand} 
particle size limit \textbf{varies from country to country}. 
\textbf{Silt} particle size range can be \textbf{2-20$\mu$m} 
(Atterberg system\cite{MINASNY2001AJSR}\cite{RICHER2008INRA}; 
'International system'; ISSS\footnote{ISSS: International Society 
of Soil Science. Now \href{www.iuss.org}{IUSS, International 
Union of Soil Science}}; Australia\footnote{Strangely, only a 
small number of countries have adopted the so called 
'international system'}\cite{MINASNY2001AJSR}; Japan% 
\cite{RICHER2008INRA}), \textbf{2-50$\mu$m} (FAO\footnote{% 
\href{www.fao.org}{Food and Agriculture Organization of the 
United Nations}}; USA; France\cite{MINASNY2001AJSR}% 
\cite{RICHER2008EGS}), \textbf{2-60$\mu$m} 
(UK and Sweden\cite{RICHER2008INRA}) or \textbf{2-63$\mu$m} 
(Germany, Austria, Denmark and The Netherlands% 
\cite{RICHER2008INRA}). Logically, \textbf{sand} particle size 
range also varies accordingly to these systems: 
\textbf{20-2000$\mu$m}, \textbf{50-2000$\mu$m}, 
\textbf{60-2000$\mu$meters} or \textbf{63-2000$\mu$meters}.\\

\textbf{Silt} class is sometimes divided into \textbf{fine silts} 
and \textbf{coarse silts}, and \textbf{sand} class is sometimes 
divided into \textbf{fine sand} and \textbf{coarse sand}, but in 
this document / package, we only focus on clay / silt / sand 
classes.\\ 

Below is a scheme representing the different particle size 
classes used in France (with Cl for Clay, FiSi for Fine Silt, 
CoSi for Coarse Silt, FiSa for Fine Sand, CoSa for Coarse Sand, 
Gr for Gravels and St for Stones). The figure is adapted 
from Moeys 2007\cite{MOEYS2007}, and based on information from 
Baize \& Jabiol 1995\cite{BAIZE1995}. The particle size axis 
(abscissa) is log-scale:



\includegraphics{soiltexture_vignette-005}



Soil particles -- and each soil particle size class -- occupy a 
given volume in the soil, and have a given mass. They are 
nevertheless generally not expressed as 'absolute' volumetric 
quantities\footnote{for instance kilograms of clay per liters of 
soil', or 'liters of clay per liter of soil'}. They are expressed 
as \textbf{'relative abundance'}, that is \textbf{kilograms of 
particles of a given class per kilograms of fine earth}. These 
measurements are also always made on dehydrated soil samples 
(dried slightly above $100^{\circ}\mathrm{C}$), in order to be 
independent from soil water content (which varies a lot in time 
and space).\\

\textbf{Soil texture} is defined as the relative abundance of the 
3 particle size classes: clay, silt and sand\footnote{But some 
systems define for than 3 particle size classes for soil texture}.\\

\textit{In summary}, important information to know when talking 
about soil texture (and using these functions):

\begin{itemize}
    \item Soil's fine earth is generally (but not always) divided 
        into 3 soil texture classes: 
    \begin{itemize} 
        \item Clay; 
        \item Silt; 
        \item Sand.
    \end{itemize} 
    \item The silt / sand limit varies: 
    \begin{itemize} 
        \item 20$\mu$m; or 
        \item 50$\mu$m; or 
        \item 60$\mu$m; or 
        \item 63$\mu$m.
    \end{itemize} 
    \item Soil texture measurement do have a specific unit and a 
        corresponding 'sum of the 3 texture classes', that is 
        constant:
    \begin{itemize} 
        \item in \% or $g.100g^{-1}$ (sum: 100); or 
        \item in fraction $[-]$ or $kg.kg^{-1}$ (sum: 1); or 
        \item in $g.kg^{-1}$ (sum: 1000); 
    \end{itemize} 
\end{itemize}


\textbf{More than 3 particle size classes?}\\

Some country have a particle size classes system that differ from 
the common 'clay silt sand' triplet. Sweden is using a system 
with 4 particle size classes: Ler [0-2$\mu$m], Mjäla [2-20$\mu$m], 
Mo [20-200$\mu$m] and Sand [200-2000$\mu$m] (See table 1 p.9 in 
Lidberg 2009\cite{LIDBERG2009}). 
Ler corresponds to clay. When considering the International or 
Australian particle size system (silt-sand limit 20$\mu$m), Mjäla 
is silt, and 'Mo + Sand' is sand. When considering other systems 
with a silt-sand limit at 50$\mu$m, 60$\mu$m or 63$\mu$m, Mjäla 
is ~fine-silt, Mo is ~'coarse-silt + fine sand', and Sand is 
~coarse-sand.\\

'The Soil Texture Wizard' has been made for systems with 3 
particle size classes (clay, silt and sand), \textbf{because soil 
texture triangles have 3 sides, and thus can only represent 
texture data that are divided into 3 particle size classes}. 
There are methods to estimate 3 particle size classes when more 
classes are presented in the data (although the best is to 
measure texture so it also can fit a system with 3 particle size 
classes system).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{What are soil texture triangle and classes} 

Soil texture triangles are also called \textbf{soil texture 
diagrams}.\\

Soil texture can be plotted on a \textbf{ternary plot} (also 
called triangle plot). In a ternary plot, 3D coordinates, which 
sum is constant, are projected in the 2D space, using simple 
trigonometry rules. The texture of a soil sample can be plotted 
inside a texture triangle, as shown in the example below for 
the texture 45\% clay, 38\% silt and 17\% sand:


\includegraphics{soiltexture_vignette-006}


When mapping soil, field pedologists usually estimate texture by 
manipulating a moist (but not saturated) soil sample in their 
hand. Depending on the relative importance of clay silt and sand, 
the mechanical properties of the soil (plasticity, stickyness, 
roughness) varies. Pedologists have 'classified' clay silt and 
sand relative abundance as a function of what they could feel in 
the field: they have divided the 'soil texture space' into 
classes.\\

\textbf{Soil particle size classes (clay, silt and sand)} should 
not be confused with \textbf{soil texture classes}. While the 
first are ranges of particle sizes, the latter are defined by a 
'range of clay, silt and sand' (see the graph below). Soil 
texture should not be confused with the concept of \textbf{soil 
structure}, that concerns the way these particles are arranged 
together (or not) into peds, clods and aggregates (etc.) of 
different size and shape\footnote{In the same way bricks and 
cement (the texture) can be arranged into a house (the structure)}. 
This document does not deal with soil structure.\\

Soil texture classes are convenient to represent soil texture 
on soil maps\footnote{It is more easy to represent 1 variable, 
soil texture class, than 3 variables: clay silt and sand}, and 
there use is quite broad (soil description, soil classification, 
pedogenesis, soil functional properties, pedotransfer functions, 
etc.). One of these texture classification systems is the FAO 
system. Here is the representation of the same point as in the 
graph above, but with the FAO soil classification system on the 
background.

\includegraphics{soiltexture_vignette-007}

The soil texture class symbols are:

% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:13 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & VF & Very fine \\ 
  2 & F & Fine \\ 
  3 & M & Medium \\ 
  4 & MF & Medium fine \\ 
  5 & C & Coarse \\ 
   \hline
\end{tabular}
\caption{Texture classes of the FAO system / triangle}
\end{center}
\end{table}
The main characteristics of the graph (texture triangle) are:

\begin{itemize}
    \item 3 Axis, graduated from 0 to 100\%, each of them 
    carrying 1 particle size class.
    \begin{itemize} 
        \item Sand on the bottom axis; 
        \item Clay on the left axis; 
        \item Silt on the right axix.
    \end{itemize} 
    \item It is possible to permute clay, silt and sand axis, but 
    this choice depend on the particle size classification used.
    \item Inside the triangle, the lines of equi-values for a 
    given axis/particle size class are ALWAYS parallel to the 
    (other) axis that intersect the axis of interest at 'zero' 
    (minimum value).
    \item The 3 axis intersect each other in 3 submits, that are 
    characterized by an \textbf{angle}. In the example above, all 
    3 angles are 60 degrees. But other angles are possible, 
    depending on the soil texture classification used. It is for 
    instance possible to have a 90 degrees angle on the left, and 
    45 degrees angles on the top and on the right (right-angled 
    triangle).
    \item The 3 axis have a \textbf{direction} of increasing 
    texture abundance. This direction is often referred as 
    'clock' or 'anticlock', but they can also be directed 'inside'
    the triangle in some cases. In the example 
    above, all the axis are clockwise: texture increase when 
    rotating in the opposite direction as a clock.
    \item \textbf{Labeled ticks} are placed at regular intervals 
    (10\%) on     the texture triangle axes, apart if the axis is 
    directed inside the triangle. Ticks can be placed at irregular 
    intervals if they are placed at each value taken by the 
    texture class polygons vertices (This is a smart 
    representation, unfortunately not implemented here).
    \item An \textbf{broken arrow} is drawn 'parallel' to each 
    axis. The first part indicate the direction of increasing 
    value, and the second, broken, part indicates the direction of 
    the equi-value for that axis/texture class.
    \item The \textbf{axis labels} indicates the texture class 
    concerned, and should ideally remind the particle size limits, 
    because these limits are of crucial importance when (re)using 
    soil texture data (Silt and Sand does not exactly mean the 
    same particle size limits everywhere).
    \item \textbf{Soil texture class boundaries} are drawn inside 
    the triangle. They are 2D representation of 3D limits. They 
    are generally \textbf{labeled} with soil texture class 
    abbreviations (or full names).
    \item Inside the triangle frame, a grid can be represented, 
    for each ticks and ticks label drawn outside the triangle.
\end{itemize}



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{Installing the package} 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Installing the package from r-forge} 


The Soil Texture Wizard is now available on \href{http://r-forge.r-project.org/}%%%
{r-forge}, under the project name \href{http://r-forge.r-project.org/projects/soiltexture/}%%%
{soiltexture}. \textbf{If you have the latest R version} installed, 
the package can be intalled with the following commands:




\begin{Schunk}
\begin{Sinput}
 install.packages( 
     pkgs  = "soiltexture", 
     repos = "http://R-Forge.R-project.org" 
 )   #
\end{Sinput}
\end{Schunk}


And it can be loaded with the following command:


\begin{Schunk}
\begin{Sinput}
 require( soiltexture ) 
\end{Sinput}
\end{Schunk}


If you get bored of the package, you can unload it and uninstall 
it with the following commands:


\begin{Schunk}
\begin{Sinput}
 detach( package:soiltexture ) 
 remove.packages( "soiltexture" ) 
\end{Sinput}
\end{Schunk}


If you don't have the latest R version, please try to install the 
package from the binaries. In the next section, an example is given 
for R under MS Windows systems (Zip binaries).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Installing the package from Windows binaries (.zip)} 


To install and load the package directly from 
\href{"http://r-forge.r-project.org/bin/windows/contrib/2.10/soiltexture_1.0.zip"}%%%
{r-forge zip binaries}, 
you can type the following command:


\begin{Schunk}
\begin{Sinput}
 download.file( 
     url = 
 "http://r-forge.r-project.org/bin/windows/contrib/2.10/soiltexture_1.0.zip", 
     destfile = file.path( getwd(), "soiltexture_1.0.zip" ) 
 )   #
 #
 install.packages( 
     pkgs  = file.path( getwd(), "soiltexture_1.0.zip" ), 
     repos = NULL 
 )   #
 #
 file.remove( "soiltexture_1.0.zip" ) 
\end{Sinput}
\end{Schunk}


\textbf{Where 2.10 should be replaced by the latest stable R 
version and 1.0 by the latest package version on r-forge}. 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Load the latest package sources} 


If all the options above failed to intall the soiltexture package, 
you can still load the 
\href{http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/*checkout*/pkg/soiltexture/R/soiltexture.r?root=soiltexture}%%%
{latest package sources} in R by using the 
following command:


\begin{Schunk}
\begin{Sinput}
 source( 
     paste( 
         sep = "", 
         "http://r-forge.r-project.org/scm/viewvc.php/*checkout*", 
         "/pkg/soiltexture/R/soiltexture.r?&root=soiltexture"
     )   #
 )   #
\end{Sinput}
\end{Schunk}


The examples shown in this vignette are ran with these sources.



% % +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
% \subsection{Set the work directory} 


% Here is the working directory we are using in this package vignette 
% (choose the one you like...):

% <<echo=TRUE>>= 
% # setwd("C:/_RTOOLS/SWEAVE_WORK/SOIL_TEXTURES/rforge/pkg/soiltexture/inst/doc/INOUT") 
% @ 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{Plotting soil texture triangles and classification 
    systems} 

The package comes with 8 predefined soil texture triangles. Empty %%% THINGS TO CHECK HERE: NB TRIANGLES
(i.e. without soil textures data) soil texture triangles can be 
plotted, in order to obtain smart representation of the soil 
texture classification. Of course, it is also possible to plot 
'classification free' texture triangles.



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{An empty soil texture triangle} 

Below is the code to display an empty triangle (without 
classification and without data):


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "none" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-015}


The option \texttt{class.sys} (characters) determines the soil 
texture classification system used. If set to \texttt{'none'}, 
an empty soil texture triangle is plotted.\\

Without further options, the plotted default soil texture 
triangle has the same geometry as the FAO, USDA or French 'Aisne' 
soil texture triangles (i.e. all axis are clockwise, all angles 
are 60 degrees, sand is on the bottom axe, clay on the left and 
silt on the right).\\

The default unit is always percentage (0 to 100\%). It is also 
equivalent to $g.100g^{-1}$.



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The USDA soil texture classification} 

To display a USDA texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "USDA.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-016}


When the option \texttt{class.sys} is set to \texttt{"USDA.TT"}, 
a soil texture triangle with USDA classification system is used.\\

The USDA soil texture triangle has been built considering a 
silt - sand limit of 
50$\mu$meters.\\ 

See the table for soil texture classes symbols.\\


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:15 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & Cl & clay \\ 
  2 & SiCl & silty clay \\ 
  3 & SaCl & sandy clay \\ 
  4 & ClLo & clay loam \\ 
  5 & SiClLo & silty clay loam \\ 
  6 & SaClLo & sandy clay loam \\ 
  7 & Lo & loam \\ 
  8 & SiLo & silty loam \\ 
  9 & SaLo & sandy loam \\ 
  10 & Si & silt \\ 
  11 & LoSa & loamy sand \\ 
  12 & Sa & sand \\ 
   \hline
\end{tabular}
\caption{Texture classes of the USDA system / triangle}
\end{center}
\end{table}

The reference used to digitize this triangle is the Soil Survey 
Manual (Soil Survey Staff 1993\cite{USDA1993}).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The FAO soil texture classification (also known as 
    'European Soil map', or 'HYPRES')} 

To display a FAO / HYPRES texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "FAO50.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-018}


De Forges et al. 2008\cite{RICHER2008EGS} pointed out the fact 
that the silt-sand particle size limit that is officially related 
to the FAO soil texture triangle has changed over time, 50$\mu$m, 
then 63$\mu$m, and then again 50$\mu$m for some projects. 
We here consider that the FAO / EU Soil map / HYPRES soil texture 
triangle has a silt - sand limit of 
50$\mu$m. As this 
choice is somehow arbitrary, we have named the 'FAO' option 
\texttt{"FAO50.TT"} in order to avoid any confusion. It will be 
explained later in the document how it is possible to add a custom 
texture triangle to the existing list, that could for instance be 
used to configure an FAO texture triangle with another silt - 
sand limit.\\ 

See the table for soil texture classes symbols.\\


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:16 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & VF & Very fine \\ 
  2 & F & Fine \\ 
  3 & M & Medium \\ 
  4 & MF & Medium fine \\ 
  5 & C & Coarse \\ 
   \hline
\end{tabular}
\caption{Texture classes of the FAO system / triangle}
\end{center}
\end{table}

The references used to digitize this triangle is the texture 
triangle provided by the HYPRES project web site 
(\cite{HYPRES2009}). The The Canadian Soil Information System 
(CanSIS) also provides some details on this triangle 
(\cite{CANSIS2009}).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The French 'Aisne' soil texture classification} 

To display a French 'Aisne' texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "FR.AISNE.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-020}


The French Aisne soil texture triangle has been built 
considering a silt - sand limit of 
50$\mu$meters.\\ 

See the table for soil texture classes symbols\footnote{In 
classes 14 and 15, 'leger' should be replaced by 'léger'. R (and 
Sweave) can not display french accents easily, and I found no easy 
trics for displaying them.}.\\


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:16 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & ALO & Argile lourde \\ 
  2 & A & Argile \\ 
  3 & AL & Argile limoneuse \\ 
  4 & AS & Argile sableuse \\ 
  5 & LA & Limon argileux \\ 
  6 & LAS & Limon argilo-sableux \\ 
  7 & LSA & Limon sablo-argileux \\ 
  8 & SA & Sable argileux \\ 
  9 & LM & Limon moyen \\ 
  10 & LMS & Limon moyen sableux \\ 
  11 & LS & Limon sableux \\ 
  12 & SL & Sable limoneux \\ 
  13 & S & Sable \\ 
  14 & LL & Limon leger \\ 
  15 & LLS & Limon leger sableux \\ 
   \hline
\end{tabular}
\caption{Texture classes of the French 'Aisne' system / triangle}
\end{center}
\end{table}
The references used for digising this triangle is Baize and 
Jabiol 1995\cite{BAIZE1995} and Jamagne 1967\cite{JAMAGNE1967}. 
This triangle may be referred as the 'Triangle des textures de la 
Chambre d'Agriculture de l'Aisne' (en: texture triangle of the 
Aisne extension service).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The French 'GEPPA' soil texture classification} 

To display a French 'GEPPA' texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "FR.GEPPA.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-022}


The French GEPPA soil texture triangle has been built 
considering a silt - sand limit of 
50$\mu$meters.\\ 

See the table for soil texture classes symbols.\\


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:17 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & AA & Argile lourde \\ 
  2 & A & Argileux \\ 
  3 & As & Argile sableuse \\ 
  4 & Als & Argile limono-sableuse \\ 
  5 & Al & Argile limoneuse \\ 
  6 & AS & Argilo-sableux \\ 
  7 & LAS & Limon argilo-sableux \\ 
  8 & La & Limon argileux \\ 
  9 & Sa & Sable argileux \\ 
  10 & Sal & Sable argilo-limoneux \\ 
  11 & Lsa & Limon sablo-argileux \\ 
  12 & L & Limon \\ 
  13 & S & Sableux \\ 
  14 & SS & Sable \\ 
  15 & Sl & Sable limoneux \\ 
  16 & Ls & Limon sableux \\ 
  17 & LL & Limon pur \\ 
   \hline
\end{tabular}
\caption{Texture classes of the French 'GEPPA' system / triangle}
\end{center}
\end{table}

This triangle has been digitized after 
\texttt{sols-de-bretagne.fr} 2009\cite{SOLBRETAGNE2009}. The 
website refers to an illustration from Baize and Jabiol 1995%
\cite{BAIZE1995}. 'GEPPA' means 'Groupe d'Etude pour les 
Problèmes de Pédologie Appliquée' (en: Group for the study of 
applied pedology problems / questions).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The German Bodenartendiagramm (B.K. 1994) soil 
    texture classification} 

To display a German Bodenartendiagramm (BK 1994) texture triangle, 
type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "DE.BK94.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-024}


The German Bodenartendiagramm (BK 1994) soil texture triangle has 
been built considering a silt - sand limit of 
63$\mu$meters.\\ 

See the table for soil texture classes symbols.\\


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:17 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & Ss & reiner Sand \\ 
  2 & Su2 & Schwach schluffiger Sand \\ 
  3 & Sl2 & Schwach lehmiger Sand \\ 
  4 & Sl3 & Mittel lehmiger Sand \\ 
  5 & St2 & Schwach toniger Sand \\ 
  6 & Su3 & Mittel schluffiger Sand \\ 
  7 & Su4 & Stark schluffiger Sand \\ 
  8 & Slu & Schluffig-lehmiger Sand \\ 
  9 & Sl4 & Stark lehmiger Sand \\ 
  10 & St3 & Mittel toniger Sand \\ 
  11 & Ls2 & Schwach sandiger Lehm \\ 
  12 & Ls3 & Mittel sandiger Lehm \\ 
  13 & Ls4 & Stark sandiger Lehm \\ 
  14 & Lt2 & Schwach toniger Lehm \\ 
  15 & Lts & Sandig-toniger Lehm \\ 
  16 & Ts4 & Stark sandiger Ton \\ 
  17 & Ts3 & Mittel sandiger Ton \\ 
  18 & Uu & Reiner Schluff \\ 
  19 & Us & Sandiger Schluff \\ 
  20 & Ut2 & Schwach toniger Schluff \\ 
  21 & Ut3 & Mittel toniger Schluff \\ 
  22 & Uls & Sandig-lehmiger Schluff \\ 
  23 & Ut4 & Stark toniger Schluff \\ 
  24 & Lu & Schluffiger Lehm \\ 
  25 & Lt3 & Mittel toniger Lehm \\ 
  26 & Tu3 & Mittel schluffiger Ton \\ 
  27 & Tu4 & Stark schluffiger Ton \\ 
  28 & Ts2 & Schwach sandiger Ton \\ 
  29 & Tl & Lehmiger Ton \\ 
  30 & Tu2 & Schwach schluffiger Ton \\ 
  31 & Tt & Reiner Ton \\ 
   \hline
\end{tabular}
\caption{Texture classes of the German system / triangle}
\end{center}
\end{table}
The references used to digitize this triangle and name the 
classes are \url{de.wikipedia.org} 2009 \cite{WIKIPEDIADE2009} 
and \texttt{nibis.ni.schule.de} 2009\cite{BK94ANONYM}. The 
triangle is also presented in GEOVLEX 2009\cite{GEOVLEX2009} 
(Online lexicon from the Halle-Wittenberg University) and Bormann 
2007\cite{BORMANN2007} (for quadruple check). The 
triangle is referred as Bodenartendiagramm 'Korngrö\ss endreieck' 
from Bodenkundliche Kartieranleitung 1994.

\clearpage % otherwise the table 'eats' next triangle



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{UK Soil Survey of England and Wales texture 
    classification} 

To display a Soil Survey of England and Wales texture triangle 
(UK), type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "UK.SSEW.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-026}


UK Soil Survey of England and Wales texture triangle has been 
built considering a silt - sand limit of 
60$\mu$meters.\\ 

See the table for soil texture classes symbols.\\

% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:18 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & Cl & Clay \\ 
  2 & SaCl & Sandy clay \\ 
  3 & SiCl & Silty clay \\ 
  4 & ClLo & Clay loam \\ 
  5 & SiClLo & Silty clay loam \\ 
  6 & SaClLo & Sandy clay loam \\ 
  7 & SaLo & Sandy loam \\ 
  8 & SaSiLo & Sandy silt loam \\ 
  9 & SiLo & Silt loam \\ 
  10 & LoSa & Loamy sand \\ 
  11 & Sa & Sand \\ 
   \hline
\end{tabular}
\caption{Texture classes of the UK system / triangle}
\end{center}
\end{table}
The reference used to digitize this triangle is Defra -- Rural 
Development Service -- Technical Advice Unit 2006\cite{DEFRA2006} 
(Technical Advice Note 52 -- Soil texture).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The Australian soil texture classification} 

To display an Autralian texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "AU.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-028}


The Australian soil texture classification has been built 
considering a silt - sand limit of 
20$\mu$meters.\\ 

See the table for soil texture classes symbols.


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:19 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & Cl & Clay \\ 
  2 & SiCl & Silty clay \\ 
  3 & SiClLo & Silt clay loam \\ 
  4 & SiLo & Silty loam \\ 
  5 & ClLo & Clay loam \\ 
  6 & Lo & Loam \\ 
  7 & LoSa & Loamy sand \\ 
  8 & SaCl & Sandy clay \\ 
  9 & SaClLo & Sandy clay loam \\ 
  10 & SaLo & Sandy loam \\ 
  11 & Sa & Sand \\ 
   \hline
\end{tabular}
\caption{Texture classes of the Australian system / triangle}
\end{center}
\end{table}

There are probably small errors in the exact placement of some 
texture classes vertices (expected to be 1 or 2\% of the 'exact 
value'), due to technical difficulties for reproducing precisely 
this triangle (reproduced after both Minasny and McBratney 
2001\cite{MINASNY2001AJSR}, and Holbeche 2008\cite{HOLBECHE2008} 
(brochure 'Soil Texture-Laboratory Method' from 
\href{http://soilquality.org.au}{soilquality.org.au}).\\



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The Belgian soil texture classification} 

To display an Belgium texture triangle, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "BE.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-030}


The Belgian soil texture classification has been built 
considering a silt - sand limit of 
50$\mu$meters.\\ 

See the table for soil texture classes symbols\footnote{In 
classes 5, 'leger' should be replaced by 'léger'. R (and 
Sweave) can not display french accents easily, and I found no easy 
trics for displaying them.}. The class names are given in French 
and in Flemish.


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:19 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & U & Argile lourde $|$ Zware klei \\ 
  2 & E & Argile $|$ Klei \\ 
  3 & A & Limon $|$ Leem \\ 
  4 & L & Limon sableux $|$ Zandleem \\ 
  5 & P & Limon sableux leger $|$ Licht zandleem \\ 
  6 & S & Sable limoneux $|$ Lemig zand \\ 
  7 & Z & Sable $|$ Zand \\ 
   \hline
\end{tabular}
\caption{Texture classes of the Belgian system / triangle}
\end{center}
\end{table}

This texture triangle has been built after images from Defourny 
et al.\cite{DEFOURNY2009} and Van Bossuyt\cite{BOSSUYT2009}.\\



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{The Canadian soil texture classification} 

To display a Canadian texture triangle with English texture class 
abbreviations, type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "CA.EN.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-032}


For the same triangle with French texture class abbreviations type:


\begin{Schunk}
\begin{Sinput}
 TT.plot( class.sys = "CA.FR.TT" ) 
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-033}


The Canadian soil texture classification has been built 
considering a silt - sand limit of 
50$\mu$meters 
(\href{http://sis.agr.gc.ca/cansis/glossary/separates,_soil.html}%%%
{reference}\cite{CANSIS2010}).\\ 

See the table for soil texture classes symbols, in English:


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:20 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & HCl & Heavy clay \\ 
  2 & SiCl & Silty clay \\ 
  3 & Cl & Clay \\ 
  4 & SaCl & Sandy clay \\ 
  5 & SiClLo & Silty clay loam \\ 
  6 & ClLo & Clay loam \\ 
  7 & SaClLo & Sandy clay loam \\ 
  8 & SiLo & Silty loam \\ 
  9 & L & Loam \\ 
  10 & SaLo & Sandy loam \\ 
  11 & LoSa & Loamy sand \\ 
  12 & Si & Silt \\ 
  13 & Sa & Sand \\ 
   \hline
\end{tabular}
\caption{Texture classes of the Canadian (en) system / triangle}
\end{center}
\end{table}

Or in French:


% latex table generated in R 2.11.0 by xtable 1.5-6 package
% Tue Jun 01 16:22:20 2010
\begin{table}[ht]
\begin{center}
\begin{tabular}{rll}
  \hline
 & abbr & name \\ 
  \hline
1 & ALo & Argile lourde \\ 
  2 & ALi & Argile limoneuse \\ 
  3 & A & Argile \\ 
  4 & AS & Argile sableuse \\ 
  5 & LLiA & Loam limono-argileux \\ 
  6 & LA & Loam argileux \\ 
  7 & LSA & Loam sablo-argileux \\ 
  8 & LLi & Loam limoneux \\ 
  9 & L & Loam \\ 
  10 & LS & Loam sableux \\ 
  11 & SL & Sable loameux \\ 
  12 & Li & Limon \\ 
  13 & S & Sable \\ 
   \hline
\end{tabular}
\caption{Texture classes of the Canadian (fr) system / triangle}
\end{center}
\end{table}


A reference image for this texture triangle can be found in 
\href{http://sis.agr.gc.ca/cansis/glossary/texture,_soil.html#figure1}%%
{this reference} (not the one used for digitizing the triangle), 
and the boundaries have been checked using 
\href{http://sis.agr.gc.ca/cansis/glossary/texture,_soil.html}%%
{this reference}\cite{CANSIS2010}.\\



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Soil texture triangle with a texture classes color 
    gradient} 

It is possible to have a nice color gradient (single hue, 
gradient of saturation and value) on the background, by setting 
the option \texttt{class.p.bg.col} (logical) to \texttt{TRUE}.\\

Example with the USDA and FAO soil texture triangles:


\begin{Schunk}
\begin{Sinput}
 # Set a 2 by 2 plot matrix:
 old.par <- par(no.readonly=T)
 par("mfcol" = c(1,2),"mfrow"=c(1,2)) 
 # Plot the triangles
 TT.plot( 
     class.sys       = "USDA.TT", 
     class.p.bg.col  = TRUE
 )   #
 TT.plot( 
     class.sys       = "FAO50.TT", 
     class.p.bg.col  = TRUE
 )   #
 # Back to old parameters:
 par(old.par)
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-036}


Example with the French Aisne and French GEPPA soil texture 
triangles:


\begin{Schunk}
\begin{Sinput}
 # Set a 2 by 2 plot matrix:
 old.par <- par(no.readonly=T)
 par("mfcol" = c(1,2),"mfrow"=c(1,2)) 
 # Plot the triangles
 TT.plot( 
     class.sys       = "FR.AISNE.TT", 
     class.p.bg.col  = TRUE
 )   #
 TT.plot( 
     class.sys       = "FR.GEPPA.TT", 
     class.p.bg.col  = TRUE
 )   #
 # Back to old parameters:
 par(old.par)
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-037}


Example with the UK (SSEW) and German (BK94) soil texture 
triangles:


\begin{Schunk}
\begin{Sinput}
 # Set a 2 by 2 plot matrix:
 old.par <- par(no.readonly=T)
 par("mfcol" = c(1,2),"mfrow"=c(1,2)) 
 # Plot the triangles
 TT.plot( 
     class.sys       = "UK.SSEW.TT", 
     class.p.bg.col  = TRUE
 )   #
 TT.plot( 
     class.sys       = "DE.BK94.TT", 
     class.p.bg.col  = TRUE
 )   #
 # Back to old parameters:
 par(old.par)
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-038}


Example with the Australian and Belgian soil texture triangle:


\begin{Schunk}
\begin{Sinput}
 # Set a 2 by 2 plot matrix:
 old.par <- par(no.readonly=T)
 par("mfcol" = c(1,2),"mfrow"=c(1,2)) 
 # Plot the triangles
 TT.plot( 
     class.sys       = "AU.TT", 
     class.p.bg.col  = TRUE
 )   #
 TT.plot( 
     class.sys       = "BE.TT", 
     class.p.bg.col  = TRUE
 )   #
 # Back to old parameters:
 par(old.par)
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-039}


And finally the Canadian texture triangle (with English and French 
abbreviations):


\begin{Schunk}
\begin{Sinput}
 # Set a 2 by 2 plot matrix:
 old.par <- par(no.readonly=T)
 par("mfcol" = c(1,2),"mfrow"=c(1,2)) 
 # Plot the triangles
 TT.plot( 
     class.sys       = "CA.EN.TT", 
     class.p.bg.col  = TRUE
 )   #
 TT.plot( 
     class.sys       = "CA.FR.TT", 
     class.p.bg.col  = TRUE
 )   #
 # Back to old parameters:
 par(old.par)
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-040}



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{Overplotting two soil texture classification systems} 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Case 1: Overplotting two soil texture classification 
    systems with the same geometry} 

Below is the code for plotting a French-Aisne texture triangle 
over a USDA texture triangle:

\begin{Schunk}
\begin{Sinput}
 # First plot the USDA texture triangle, and retrieve its 
 #   geometrical features, silently outputted by TT.plot 
 geo <- TT.plot( 
     class.sys   = "USDA.TT", 
     main        = "USDA and French Aisne triangles, overplotted"  
 )   # 
 # Then overplot the French Aisne texture triangle, 
 #   and customise the colors so triangles are well distinct.
 TT.classes(
     geo             = geo, 
     class.sys       = "FR.AISNE.TT", 
     # Additional "graphical" options
     class.line.col  = "red", 
     class.lab.col   = "red", 
     lwd.axis        = 2  
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-041}

Beware that the result may not necessarily be very readable when 
printed, in black and white. Consider to change the line type as 
well (option \texttt{class.lty = 2} for \texttt{TT.classes}) 
is you want a more printer-friendly output.



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Case 2: Overplotting two soil texture classification 
    systems with different geometries} 

Below is the code to plot a French GEPPA texture triangle over a 
French Aisne texture triangle. The code is in fact almost 
identical to the previous case:

\begin{Schunk}
\begin{Sinput}
 # First plot the USDA texture triangle, and retrieve its 
 #   geometrical features, silently outputted by TT.plot 
 geo <- TT.plot( 
     class.sys   = "FR.AISNE.TT", 
     main        = "French Aisne and GEPPA triangles, overplotted"  
 )   # 
 # Then overplot the French Aisne texture triangle, 
 #   and customise the colors so triangles are well distinct.
 TT.classes(
     geo             = geo, 
     class.sys       = "FR.GEPPA.TT", 
     # Additional "graphical" options
     class.line.col  = "red", 
     class.lab.col   = "red", 
     lwd.axis        = 2  
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-042}



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\section{Plotting soil texture data} 



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Simple plot of soil texture data} 

First, lets create a table containing (dummy) soil texture data, 
(in \%), as well as dummy organic carbon content (in $g.kg^{-1}$, 
for later use):

\begin{Schunk}
\begin{Sinput}
 # Create a dummy data frame of soil textures:
 my.text <- data.frame( 
     "CLAY"  = c(05,60,15,05,25,05,25,45,65,75,13,47), 
     "SILT"  = c(05,08,15,25,55,85,65,45,15,15,17,43), 
     "SAND"  = c(90,32,70,70,20,10,10,10,20,10,70,10), 
     "OC"    = c(20,14,15,05,12,15,07,21,25,30,05,28)  
 )   #
 # Display the table:
 my.text
\end{Sinput}
\begin{Soutput}
   CLAY SILT SAND OC
1     5    5   90 20
2    60    8   32 14
3    15   15   70 15
4     5   25   70  5
5    25   55   20 12
6     5   85   10 15
7    25   65   10  7
8    45   45   10 21
9    65   15   20 25
10   75   15   10 30
11   13   17   70  5
12   47   43   10 28
\end{Soutput}
\end{Schunk}

The columns names include CLAY, SILT and SAND, so they are 
explicit for the \texttt{TT.plot} function. 
The code to display these soil texture data is:

\begin{Schunk}
\begin{Sinput}
 TT.plot( 
     class.sys   = "FAO50.TT", 
     tri.data    = my.text, 
     main        = "Soil texture data" 
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-044}

The option \texttt{tri.data} is a data frame containing numerical 
values. \texttt{colnames(tri.data)} must match with 
\texttt{blr.tex} option's values (default 
\texttt{c("CLAY","SILT","SAND")}). More columns can be provided, 
but are not used unless other options are chosen (see below).



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Bubble plot of soil texture data and a 3rd variable} 

It could be interesting to plot the organic carbon content on top 
of the soil texture triangle. Bubble plots are good for this:


\begin{Schunk}
\begin{Sinput}
 TT.plot( 
     class.sys   = "none", 
     tri.data    = my.text, 
     z.name      = "OC", 
     main        = "Soil texture triangle and OC bubble plot" 
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-045}


The option \texttt{z.name} is a character string, the 
name of the column in \texttt{tri.data} that contains a 3rd 
variable to be plotted.\\

The 3rd variable is plotted with an 'expansion' factor 
proportional to \texttt{z.name} value. Low values have a small 
diameter and high values have a big diameter. To re-enforce the 
visual effect, a single hue color gradient is added to the point 
background, with hight saturation and high color's value (bright) 
for low \texttt{z.name}'s values, and low saturation and low 
color's value (dark) for high \texttt{z.name}'s values.\\

The function keeps good visual effect, even with a lot of values. 
Below is a test using \texttt{TT.dataset()} function, that 
generate a (quick and dirty) dummy soil texture datasets, with a 
4th z variable (named 'Z'), correlated to the texture data.


\begin{Schunk}
\begin{Sinput}
 rand.text	<- TT.dataset(n=100,seed.val=1980042401)
\end{Sinput}
\end{Schunk}


\begin{Schunk}
\begin{Sinput}
 TT.plot( 
     class.sys   = "none", 
     tri.data    = rand.text, 
     z.name      = "Z", 
     main        = "Soil texture triangle and Z bubble plot" 
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-047}


This function is primarily intended for exploratory data analysis 
or for rather qualitative analysis, as it is difficult for the 
reader to know the real \texttt{z.name} value of a point. It is 
nevertheless possible to add 'manually' a legend, as in the 
example below:


\begin{Schunk}
\begin{Sinput}
 TT.plot( 
     class.sys   = "none", 
     tri.data    = my.text, 
     z.name      = "OC", 
     main        = "Soil texture triangle and OC bubble plot" 
 )   #
 # Recompute some internal values:
 z.cex.range <- TT.get("z.cex.range") 
 def.pch     <- par("pch") 
 def.col     <- par("col")
 def.cex     <- TT.get("cex") 
 oc.str      <- TT.str( 
     my.text[,"OC"], 
     z.cex.range[1], 
     z.cex.range[2]
 )   #
 # The legend:
 legend( 
     x           = 80, 
     y           = 90, 
     title       = 
         expression( bold('OC [g.kg'^-1 ~ ']') ), 
     legend      = formatC( 
         c( 
             min( my.text[,"OC"] ), 
             quantile(my.text[,"OC"] ,probs=c(25,50,75)/100), 
             max( my.text[,"OC"] ) 
         ), 
         format  = "f", 
         digits  = 1, 
         width   = 4, 
         flag    = "0" 
     ),  #
     pt.lwd      = 4, 
     col         = def.col, 
     pt.cex      = c( 
             min( oc.str ), 
             quantile(oc.str ,probs=c(25,50,75)/100), 
             max( oc.str ) 
     ),  #, 
     pch         = def.pch, 
     bty         = "o", 
     bg          = NA, 
     box.col     = NA, 
     text.col    = "black", 
     cex         = def.cex  
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-048}


This code is obviously complicated, but it produces a smart 
legend. It is not possible (or easy) to add an automatic legend 
to a plot, because the optimal number of decimals may change from 
dataset to dataset, as well as the quantiles displayed.



% +~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
\subsection{Heatmap and / or contour plot of soil texture data 
    and a 4th variable} 

Another way to explore a 4th variable is heatmap. The heatmap 
represent a local average value (by inverse distance 
interpolation) of the 4th variable in the form of a colored map.\\

Plotting a heatmap now follows 4 steps, that somehow works as 
'sandwich' plots:

\begin{itemize} 
    \item (1) Retrieve the geometrical parameters of the future plot 
    with \texttt{TT.geo.get()} function. It doesn't plot anything, 
    but returns geometrical parameters that will be used to 
    determine the x-y grid on which calculating the inverse distance. 
    A call to \texttt{geo <- TT.plot()} would also work.
    \item (2) Calculate inverse weighted distances of the 4th variable 
    (here 'Z') on a regular x-y grid, using \texttt{TT.iwd()} 
    function. It returns a grid with interpolated values.
    \item (3) Plot this grid with the function \texttt{TT.image()} (or 
    with \texttt{TT.contour()}). This function is a wrapper for 
    the \texttt{image()} (or \texttt{TT.contour()}) function, 
    adapted to triangle plots. The grid format is compatible with 
    \texttt{image()} or \texttt{TT.contour()}. \texttt{TT.image()} 
    can have an option \texttt{add = TRUE} to plot the image on top 
    of an existing triangle plot.
    \item (4) Add a standard triangle plot on to of the heatmap, using 
    the standard \texttt{TT.plot()} function (with 
    \texttt{add = TRUE}). If plot has been called in step 1, step 
    4 is not necessary, and the heatmap is plotted on top of the 
    existing triangle.
\end{itemize} 


% Uncomment this to display the heatmap
\begin{Schunk}
\begin{Sinput}
 geo <- TT.geo.get() 
 #
 iwd.res <- TT.iwd( 
     geo         = geo, 
     tri.data    = rand.text, 
     z.name      = "Z", 
 )   #
 #
 TT.image( 
     x       = iwd.res, 
     geo     = geo, 
     main    = "Soil texture triangle and Z heatmap" 
 )   # 
 #
 TT.plot( 
     geo         = geo, 
     grid.show   = FALSE, 
     add         = TRUE  #  <<-- important 
 )   #
\end{Sinput}
\end{Schunk}
\includegraphics{soiltexture_vignette-049}

\texttt{TT.iwd()} has 3 important parameters: 
\begin{itemize} 
    \item (1) \texttt{pow} (default value 0.5) is the power used 
    for the inverse weighted distance interpolation. Low values 
    means strong smoothing, and vice versa; 
    \item (2) \texttt{q.max.dist} (default value 0.5) is used to 
    determines the maximum (Euclidian) distance of the points used to 
    calculate interpolated values. Data points located further than 
    that distance are not used. \texttt{q.max.dist} is the quantile of 
    the Euclidian distance, so 0.5 means that points located further 
    that the 50\% quantile of all Euclidian distances will not be 
    used to calculate a given grid value (notice that this is very 
    experimental!). The higher the value, the more points used to 
    calculate the interpolated values (and the stronger the smoothing); 
    \item (3) \texttt{n} is the number of x and y values used to 
    calculate the interpolation grid. The number of nodes in the 
    grid is $n^2$.
\end{itemize} 

\texttt{TT.image()} accepts most of the options existing in 
\texttt{image()}.\\

The is no 'heatmap legend', but it is possible to add a contour 
plot to the existing plot, in order to replace the color legend:


% Uncomment this to display the heatmap
\begin{Schunk}
\begin{Sinput}
 TT.image( 
     x       = iwd.res, 
     geo     = geo, 
     main    = "Soil texture triangle and Z heatmap" 
 )   # 
 #
 TT.contour( 
     x       = iwd.res, 
     geo     = geo, 
     add     = TRUE, #  <<-- important
     lwd     = 2  
 )   # 